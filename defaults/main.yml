---

nms_librenms_env_common:
  TZ: "{{ nms_timezone }}"
  PUID: "{{ nms_user_id }}"
  PGID: "{{ nms_group_id }}"

nms_librenms_env_mysql:
  MYSQL_DATABASE: "{{ nms_librenms_mysql_database }}"
  MYSQL_USER: "{{ nms_librenms_mysql_user }}"
  MYSQL_PASSWORD: "{{ nms_librenms_mysql_password }}"
  MYSQL_ALLOW_EMPTY_PASSWORD: "yes"

nms_librenms_env_proc:
  MEMORY_LIMIT: 256M
  MAX_INPUT_VARS: 1000
  UPLOAD_MAX_SIZE: 16M
  OPCACHE_MEM_SIZE: 128
  REAL_IP_FROM: 0.0.0.0/32
  REAL_IP_HEADER: X-Forwarded-For
  LOG_IP_VAR: remote_addr

  CACHE_DRIVER: redis
  SESSION_DRIVER: redis
  REDIS_HOST: redis

  LIBRENMS_SNMP_COMMUNITY: "{{ nms_snmp_community }}"

  LIBRENMS_WEATHERMAP: "{{ nms_weathermap_enable }}"
  LIBRENMS_WEATHERMAP_SCHEDULE: "*/5 * * * *"

nms_librenms_additional_config: ""

nms_weathermap_enable: 'false'
nms_snmp_community: public
nms_timezone: UTC

nms_user: "nms"
nms_group: "nms"

nms_librenms_mysql_database: "librenms"
nms_librenms_mysql_user: "librenms"
# nms_librenms_mysql_password: ""

nms_deploy_name: "nms"

# nms_data_librenms_db: "/volume1/librenms_db"
# nms_data_librenms_data: "/volume1/librenms_data"

nms_config_dir: /etc/nms/

nms_certificate: ""
nms_certificate_key: ""

nms_librenms_http_port: 8000
nms_librenms_https_port: 8443

nms_librenms_nginx_http_conf: |
  server {
      listen 8000;
      listen [::]:8000;

      root /opt/librenms/html;
      index index.php;

      location / {
          try_files $uri $uri/ /index.php?$query_string;
      }

      location /api/v0 {
          try_files $uri $uri/ /api_v0.php?$query_string;
      }

      location ~ \.php$ {
          fastcgi_split_path_info ^(.+\.php)(/.*)$;
          set $path_info $fastcgi_path_info;
          try_files $fastcgi_script_name =404;
          include fastcgi_params;
          fastcgi_param SERVER_SOFTWARE "";
          fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
          fastcgi_param PATH_INFO $path_info;
          fastcgi_index index.php;
          fastcgi_pass unix:/var/run/php-fpm/php-fpm.sock;
          fastcgi_buffers 256 4k;
          fastcgi_buffer_size 32k;
          fastcgi_intercept_errors on;
          fastcgi_read_timeout 14400;
      }

      location ~ /\.ht {
          deny all;
      }
  }

nms_librenms_nginx_https_conf: |
  server {
      listen 8443 ssl http2;
      listen [::]:8443 ssl http2;

      ssl_certificate librenms.crt;
      ssl_certificate_key librenms.key;
      ssl_protocols TLSv1.2 TLSv1.3;

      root /opt/librenms/html;
      index index.php;

      location / {
          try_files $uri $uri/ /index.php?$query_string;
      }

      location /api/v0 {
          try_files $uri $uri/ /api_v0.php?$query_string;
      }

      location ~ \.php$ {
          fastcgi_split_path_info ^(.+\.php)(/.*)$;
          set $path_info $fastcgi_path_info;
          try_files $fastcgi_script_name =404;
          include fastcgi_params;
          fastcgi_param SERVER_SOFTWARE "";
          fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
          fastcgi_param PATH_INFO $path_info;
          fastcgi_index index.php;
          fastcgi_pass unix:/var/run/php-fpm/php-fpm.sock;
          fastcgi_buffers 256 4k;
          fastcgi_buffer_size 32k;
          fastcgi_intercept_errors on;
          fastcgi_read_timeout 14400;
      }

      location ~ /\.ht {
          deny all;
      }
  }

nms_oxidized_config: |
  ---
  username: username
  password: password
  model: cisco
  resolve_dns: false
  interval: 3600
  use_syslog: false
  debug: false
  threads: 30
  use_max_threads: false
  timeout: 120
  retries: 3
  prompt: !ruby/regexp /^([\w.@-]+[#>]\s?)$/
  rest: 0.0.0.0:8888
  next_adds_job: false
  vars: {}
  groups: {}
  group_map: {}
  models: {}
  pid: "~/pid"
  crash:
    directory: "~/.config/oxidized/crashes"
    hostnames: false
  stats:
    history_size: 10
  input:
    default: ssh, telnet
    debug: false
    ssh:
      secure: false
    ftp:
      passive: true
    utf8_encoded: true
  output:
    default: git
    git:
      user: oxidized
      email: oxidized@localhost
      repo: "~/data/store.git"
  source:
    default: http
    debug: false
    http:
      url: http://librenms_main:8000/api/v0/oxidized
      map:
        name: hostname
        model: os
        group: group
      headers:
        X-Auth-Token: 'xxxxxxxx'
  model_map:
    juniper: junos
    cisco: ios
